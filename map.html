<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="root">
    <el-menu
            :default-active="activeIndex"
            class="el-menu-demo"
            mode="horizontal"
            @select="handleSelect"
            background-color="#545c64"
            text-color="#fff"
            active-text-color="#ffd04b">
        <el-menu-item index="1">Map</el-menu-item>
        <el-menu-item index="2">Living in NSW</el-menu-item>
        <el-menu-item index="3">Working and business</el-menu-item>
        <el-menu-item index="4">What's happening</el-menu-item>
    </el-menu>

    <div class="container">
        <div class="banner_content">
            <div class="large">COVID-19 case locations map</div>
            <div class="mid">Search the case locations list by postcode, suburb or town to find out if you have visited a location in regional NSW or Greater Sydney with a confirmed COVID-19 case in the last 14 days.</div>
        </div>
    </div>

    <div class="container">
        <label>
            Search by location<br>
            <gmap-autocomplete
                    placeholder="Enter postcode or suburb"
                    @place_changed="setPlace" style="height: 33px;">
            </gmap-autocomplete>
            <el-button @click="usePlace" type="primary">Search</el-button>
        </label>
        <br />
    </div>

    <div class="map-key">
        <div class="container">
            <span style="font-weight: 600;">Key</span>
            <span class="key_item"><img src="/images/m1.png">Multiple case locations</span>
            <span class="key_item"><img src="/images/map-marker-icon.png">Case location</span>
        </div>
    </div>

    <Gmap-Map :center="center" :zoom="changingZoom" :options="{scrollwheel: false}" style="width: 100%; height: 800px">
        <gmap-cluster>
            <gmap-info-window :options="infoOptions" :position="infoWindowPos" :opened="infoWinOpen" @closeclick="infoWinOpen=false">
            </gmap-info-window>
            <Gmap-Marker
                    v-for="(marker, index) in markers"
                    :key="index"
                    :position="marker.position"
                    :clickable="true"
                    @click="toggleInfoWindow(marker, index)"
            ></Gmap-Marker>
        </gmap-cluster>
    </Gmap-Map>
</div>

<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
<link rel="stylesheet" href="css/map.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://unpkg.com/@google/markerclustererplus@5.1.0/dist/markerclustererplus.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gmap-vue@1.5.0/dist/gmap-vue.min.js"></script>

<script>
    Vue.use(GmapVue, {
        load: {
            key: 'AIzaSyAuklIUwSVc1sMkwzx-NQ5cJMEH6RGmDqY',
            libraries: 'places'
        },
    });

    document.addEventListener('DOMContentLoaded', function () {
        Vue.component('gmap-cluster', GmapVue.Cluster);
        new Vue({
            el: '#root',
            data: {
                activeIndex: '1',
                changingZoom: 15,
                infoWindowPos: null,
                infoWinOpen: false,
                currentMidx: null,
                infoOptions: {
                    content: '',
                    //optional: offset infowindow so it visually sits nicely on top of our marker
                    pixelOffset: {
                        width: 0,
                        height: -35
                    }
                },
                center: {
                    lat: -33.872780,
                    lng: 151.206166
                },
                markers: [{
                    position: {
                        lat: -33.909087,
                        lng: 151.206700
                    },
                    infoText: '<strong>Case date</strong><br>Friday 13 August 2021'
                }, {
                    position: {
                        lat: -33.963933,
                        lng: 151.098203
                    },
                    infoText: '<strong>Case date</strong><br>Friday 13 August 2021'
                }, {
                    position: {
                        lat: -33.960107,
                        lng: 151.103578
                    },
                    infoText: '<strong>Case date</strong><br>Friday 13 August 2021'
                }, {
                    position: {
                        lat: -33.960549,
                        lng: 151.116456
                    },
                    infoText: '<strong>Case date</strong><br>Friday 13 August 2021'
                }, {
                    position: {
                        lat: -33.971936,
                        lng: 151.102890
                    },
                    infoText: '<strong>Case date</strong><br>Friday 13 August 2021'
                }, {
                    position: {
                        lat: -33.876056,
                        lng: 151.103908
                    },
                    infoText: '<strong>Case date</strong><br>Friday 13 August 2021'
                }, {
                    position: {
                        lat: -33.873300,
                        lng: 151.210224
                    },
                    infoText: '<strong>Case date</strong><br>Friday 13 August 2021'
                },  {
                    position: {
                        lat: -33.873776,
                        lng: 151.098587
                    },
                    infoText: '<strong>Case date</strong><br>Friday 13 August 2021'
                }, {
                    position: {
                        lat: -33.881616,
                        lng: 151.205826
                    },
                    infoText: '<strong>Case date</strong><br>Friday 13 August 2021'
                }, {
                    position: {
                        lat: -33.879513,
                        lng: 151.178151
                    },
                    infoText: '<strong>Case date</strong><br>Friday 13 August 2021'
                }],
                place: null,
            },
            methods: {
                setDescription(description) {
                    this.description = description;
                },
                setPlace(place) {
                    this.place = place
                },
                usePlace(place) {
                    if (this.place) {
                        this.center.lat = this.place.geometry.location.lat(),
                        this.center.lng = this.place.geometry.location.lng(),
                        this.place = null;
                    }
                },
                toggleInfoWindow: function(marker, idx) {
                    this.infoWindowPos = marker.position;
                    this.infoOptions.content = marker.infoText;

                    //check if its the same marker that was selected if yes toggle
                    if (this.currentMidx == idx) {
                        this.infoWinOpen = !this.infoWinOpen;
                    }

                    //if different marker set infowindow to open and reset current marker index
                    else {
                        this.infoWinOpen = true;
                        this.currentMidx = idx;
                    }
                }
            }
        });
    });
</script>
</body>
</html>